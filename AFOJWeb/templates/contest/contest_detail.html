{% extends 'base.html' %}
{%block css%}
{%endblock%}
{%block title%}
空军航空大学在线判题系统-比赛
{%endblock%} 
{%load digittoalpha %}
{% block body %}
<div class="bs-docs-header" id="content">
      <div class="container">
       <h1>{{contest.title}}</h1>

    <p>{{contest.description}}
                </p>
        
      </div>
    </div>
    <div class="container">
    <div class="center-block">
        <h2>{{contest.title}}</h2>
        <div class="progress ">
            <div class="progress-bar" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
            <span class="sr-only">40% Complete (success)</span>
        </div>
    </div>
</div>
<div class="container">
  
<ul class="nav nav-tabs" role="tablist" id="myTab">
  <li role="presentation" class="active"><a href="#problem" role="tab" data=toggle="tab">题目</a></li>
  <li role="presentation"  role="tab" data=toggle="tab"><a href="#rank">
排名</a></li>

</ul>

<div class="tab-content">
  <div  role="tabpanel" class="tab-pane fade in active" id="problem" aria-labeledBy="home-tab">
    <br>
    <table>


                <tr>
                    <td align="right">现在时间 :</td>
                    <td><span id="date" class="text-primary">{{now | date:"o-n-j G:i:s"}}</span></td>
                    
                </tr>
                <tr>
                    <td align="right">开始时间 :</td>
                    <td class="text-primary">{{contest.start_time | date:"o-n-j G:i:s" }}</td>
                </tr>
                <tr>
                    <td align="right">结束时间 :</td>
                    <td class="text-primary">{{contest.end_time | date:"o-n-j G:i:s"}}</td>
                </tr>
                <tr>
                    <td align="right">状态 :</td>
                    <td><span class="label label-primary" id="status">Success</span></td>
                </tr>
            </table>
            <br>
<table class="table table-striped table-condensed table-hover">
          <thead>
            <th>编号</th>
            <th>题目</th>
            <th>通过/提交</th>
  
          </thead>
          <tbody>
            {%for item in problems%}
            <tr>
              <td>{{item.num|digittoalpha}}</td>
              <td><a href="/problemlist/problem/{{item.problem_id}}?cid={{contest.id}}">{{item.problem.title}}</a></td>
              <td>{{item.ac}}/{{item.submit}}</td>
            </tr>
            {%endfor%}
          </tbody>
        </table>
  </div>
<div  role="tabpanel" class="tab-pane fade " id="rank" aria-labeledBy="rank-tab">


    <table class="table table-striped table-condensed table-hover">
      <th>#</th>
      <th>用户</th>
      <th>解题数</th>
      <th>总时间</th>
      {%for item in problems%}
          <th>{{item.num|digittoalpha}}</th>
      {%endfor%}
      <tbody>
        {%for item in contest_rank_info%}
        <tr>
          <td>{{forloop.counter}}</td>
          <td>
        {{item.0}}
          </td>
          <td>{{item.1}}</td>
          <td>{{item.2}}</td>
          {%for pro_time in item.3%}
            {%if pro_time.submit%}
              {%if pro_time.ac_time %}
                {%if pro_time.unsolved%}
                <td>{{pro_time.ac_time}}(-{{pro_time.unsolved}})</td>
                {%else%}
                 <td>{{pro_time.ac_time}}</td>
                {%endif%}
                
                {%endif%}
                {%else%}
                <td></td>
                {%endif%}
          {%endfor%}
        </tr>
        {%endfor%}
      </tbody>
    </table>
</div>
</div>
<script>
$('#myTab a').click(function (e) {
  e.preventDefault()
  $(this).tab('show')
})
</script>
 <script>
  var diff=new Date("{{now | date:"o-n-j G:i:s"}}").getTime()-new Date().getTime();

function clock()
    {
      var x,h,m,s,n,xingqi,y,mon,d;
      var x = new Date(new Date().getTime()+diff);
      y = x.getYear()+1900;
      if (y>3000) y-=1900;
      mon = x.getMonth()+1;
      d = x.getDate();
      xingqi = x.getDay();
      h=x.getHours();
      m=x.getMinutes();
      s=x.getSeconds();
  
      n=y+"-"+mon+"-"+d+" "+(h>=10?h:"0"+h)+":"+(m>=10?m:"0"+m)+":"+(s>=10?s:"0"+s);
      // alert(n);
      document.getElementById('date').innerHTML=n;
      setTimeout("clock()",1000);
    } 
    clock();
var planstart=new Date("{{contest.start_time | date:"o-n-j G:i:s" }}");
var planend=new Date("{{contest.end_time | date:"o-n-j G:i:s"}}");
function update(){
    var now = new Date(new Date().getTime()+diff);
    if(now<planend && now >planstart){
       var   progress=0;
        progress=(planend-now)/(planend-planstart)*100+"%";
        
        $(".progress-bar").css("width",progress);
        
        $(".progress").addClass("progress-striped active");
        n="正在运行";
        document.getElementById('status').innerHTML=n;
    }
    setTimeout("update()",1000);
}
    update();
    var now = new Date(new Date().getTime()+diff);
    if(now>planend){
        $(".progress-bar").css("width",0+"%");
        $("#status").removeClass("label-primary").addClass("label-default");
        n="过期";
        document.getElementById('status').innerHTML=n;
    }
    if(now<planstart){
        $(".progress-bar").removeClass("progress-striped active").addClass("progress-bar-success");       
        $(".progress-bar").css("width",100+"%");
        n="计划中";
        document.getElementById('status').innerHTML=n;
        $("#status").removeClass("label-primary").addClass("label-success");
    }

 </script>
{% endblock %}

